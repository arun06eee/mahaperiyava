<!doctype html>
<html lang="en">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" />

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />

	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" />

	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">

	<style rel="stylesheet">
		html,
		body {
			font-family: 'Raleway', sans-serif;
		}

		.datepicker table tr td.disabled,
		.datepicker table tr td.disabled:hover {
			cursor: no-drop;
			background-color: none;
			border-color: none;
		}

		.datepicker table tr td.day.focused,
		.datepicker table tr td.day:hover {
			background-color: #0dcaf0 !important;
			border-color: #0dcaf0;
		}

		.datepicker table tr td.disabled.day.focused,
		.datepicker table tr td.disabled.day:hover {
			background-color: transparent !important;
			/* border-color: #ccc; */
		}

		td.day.active {
			color: #fff !important;
		}

		td.day,
		td.new.day {
			font-weight: bolder;
			color: #000 !important;
			border: 1px solid #999;
		}

		td.day.disabled,
		td.new.disabled.day {
			font-weight: normal;
			border: none;
			color: #999 !important;
		}
	</style>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

	<script>
		let selectDate;
		let selectTimer;
		let NumberofDate = 1;
		let slotLength = 10;
		let slotDuration = 30 * 60000;
		let startTime = 7 * 60 * 60000;
		let endTime = 17 * 60 * 60000;
		let startDate = "tomorrow";
		let endDate;

		let getSlots = [];

		const showSlotTime = (selectTime) => {

			let currentDate = selectTime + startTime;
			let stopTime = selectTime + endTime;

			let tmpArr = [];
			for (let i = 0; i < slotLength; i++) {

				let hour = new Date(currentDate).getHours();
				let min = new Date(currentDate).getMinutes();
				let AMPM = hour >= 12 ? 'PM' : 'AM';

				min = min <= 9 ? "0" + min : min;
				hour = hour <= 12 ? hour : (hour - 12);
				hour = hour <= 9 ? "0" + hour : hour;

				if (currentDate <= stopTime) {
					let setTimeValue = `${hour}:${min} ${AMPM}`;

					let checkSlot = getSlots.find(slot => slot.time === setTimeValue && slot.date === selectDate);

					let disabledClass = !checkSlot ? 'btn-outline-primary slotTimepickup' : 'btn-success disabled';

					tmpArr.push(`<input type="button" class="btn m-2 ${disabledClass}" value="${setTimeValue}" style="width:6rem; ${checkSlot ? 'cursor: no-drop;pointer-events: auto;' : ''}"  />`)
				}

				currentDate = currentDate + slotDuration;
			}

			$("#slotTime .slotTimeDisplay").empty().append(tmpArr.join(''))
			$("#slotTime").removeClass('d-none');
		}

		const getEndDate = (days) => {
			let currentDate = new Date().getTime() + days;

			let timestamp = new Date(currentDate);
			let date = timestamp.getDate();
			let month = timestamp.getMonth() + 1;
			let year = timestamp.getFullYear();

			return new Date(`${month}-${date}-${year}`)
		}

		const getBookingSlot = async () => {

			const response = await fetch(`https://vuejs-892cb-default-rtdb.firebaseio.com/slots.json`)

			const responseData = await response.json();

			if (!response.ok) {
				const error = new Error(responseData.message || 'Failed to fetch!');
				throw error;
			}

			getSlots = [];

			for (const key in responseData) {
				const slot = {
					id: key,
					name: responseData[key].name,
					email: responseData[key].email,
					phone: responseData[key].phone,
					address: responseData[key].address,
					date: responseData[key].date,
					time: responseData[key].time
				};

				getSlots.push(slot);

			}
		}

		const displayMsg = (display) => {
			$(".modal-header").removeClass('bg-success text-white bg-danger').addClass(display.class);
			$(".modal-title").html(display.title);
			$(".modal-body").html(display.content);

			$(".modal").modal('show');
		}

		$(document).ready(function () {

			getBookingSlot();
			endDate = getEndDate(24 * 1000 * 60 * 60 * (NumberofDate + 1));
			startDate = getEndDate((24 * 1000 * 60 * 60 * 1));

			$('#slotpicker').datepicker({
				startDate: startDate,
				endDate: endDate,
				// todayHighlight: true,
				// daysOfWeekDisabled: "0,6"
			})
				.on('changeDate', function (e) {
					selectDate = e.format();
					const selectDateTimeStamp = new Date(selectDate).getTime();
					let currentDate = new Date().getTime();

					if (selectDate) {
						showSlotTime(selectDateTimeStamp)
					}
				});

			$(".table-condensed").addClass('table');
			$(".datepicker").removeClass('datepicker-inline');

			$(document).on('click', '.slotTimepickup', (e) => {
				$(".slotTimepickup").removeClass('btn-primary').addClass('btn-outline-primary');
				$(e.target).removeClass('btn-outline-primary').addClass('btn-primary');
				$(".timer-btn").removeClass('btn-secondary').addClass('btn-success')

				$(".progress-bar").width("100%");

				selectTimer = $(e.target).val();
			})

			$(document).on('submit', '#slotSubmit', (e) => {
				e.preventDefault();

				let firstName = $.trim($("#firstName").val());
				let emailAddress = $.trim($("#emailAddress").val());
				let phoneNumber = $.trim($("#phoneNumber").val());
				let address = $.trim($("#address").val());
				let bool = true;
				let err = {};
				err["title"] = "<i class='fa fa-times-circle fa-1x pe-2' aria-hidden='true'></i> Error";
				err["class"] = "bg-danger text-white";

				if (!selectDate) {
					err['content'] = "<h4>Please Choose Your appointment Slot</h4>";
					displayMsg(err)
					bool = false;
					return;
				};

				if (!selectTimer) {
					err['content'] = "<h4>Choose Your appointment Slot Time</h4>";
					displayMsg(err)
					bool = false;
					return;
				};

				if (!firstName || firstName === "") {
					err['content'] = "<h4>Please enter your Full Name</h4>";
					displayMsg(err)
					bool = false;
					return;
				};

				if (!emailAddress || emailAddress === "" || !emailAddress.includes("@")) {
					err['content'] = "<h4>Please enter your Email Address</h4>";
					displayMsg(err)
					bool = false;
					return;
				};

				if (!phoneNumber || phoneNumber === "") {
					err['content'] = "<h4>Please enter your Phone number</h4>";
					displayMsg(err)
					bool = false;
					return;
				};

				if (!address || address === "") {
					err['content'] = "<h4>Please enter your Address Details</h4>";
					displayMsg(err)
					bool = false;
					return;
				};


				const data = {
					name: firstName,
					email: emailAddress,
					phone: phoneNumber,
					address: address,
					date: selectDate,
					time: selectTimer
				}

				if (bool) {

					const response = fetch(`https://vuejs-892cb-default-rtdb.firebaseio.com/slots.json`, {
						method: 'POST',
						body: JSON.stringify(data)
					}).then(response => response.json())
						.then(data => {

							$("#firstName").val("");
							$("#emailAddress").val("");
							$("#phoneNumber").val("");
							$("#address").val("");
							selectTimer = null;
							selectDate = null;
							$("#slotpicker").datepicker("clearDates");
							$("#slotTime").addClass('d-none');

							displayMsg({
								"title": "<i class='fa fa-check fa-1x pe-2' aria-hidden='true'></i> Success!",
								"content": "Your Appointment was Successfully created!",
								"class": "bg-success text-white"
							});

							getBookingSlot();
						});
				}

			})

		});
	</script>

	<title>Periyavaarul</title>
</head>

<body class="bg-light">

	<nav class="py-2 bg-white border-bottom shadow">
		<div class="container-fluid d-flex flex-wrap">
			<ul class="nav me-auto">
				<li class="nav-item">
					<a href="/"
						class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
						<img class="bi me-2" width="40" height="40"
							src="https://static.wixstatic.com/media/b7b229_f1ac89e386784b4d9a7e30d0bd070554~mv2.jpg/v1/fill/w_235,h_176,al_c,q_80,usm_0.66_1.00_0.01/b7b229_f1ac89e386784b4d9a7e30d0bd070554~mv2.webp" />

						<span class="fs-4 text-uppercase">Periyavaarul</span>
					</a>
				</li>
			</ul>
			<ul class="nav">
				<li class="nav-item"><a href="index.html" class="nav-link link-dark px-2">Home</a></li>
				<li class="nav-item"><a href="admin.html" class="nav-link link-dark px-2">Admin</a></li>
			</ul>
		</div>
	</nav>

	<div class="container-fluid m-0 bg-white">
		<div class="row border-bottom">
			<div class="col-md-6 ps-0">
				<!-- <article class="col-sm-12 p-0" style="height: 500px;"> -->
					<figure class="text-white">
						<div
							style="height: 500px; background-image: linear-gradient(0deg, rgba(60, 65, 60, 0.4), rgba(77, 75, 75, 0.4)), url('https://static.wixstatic.com/media/b7b229_c71e8ff2b50d48709149a2a0d527f2bc~mv2.jpg/v1/fill/w_566,h_319,al_c,q_90/b7b229_c71e8ff2b50d48709149a2a0d527f2bc~mv2.webp'); background-size: cover; background-position: 50% center;">
							<img src="https://static.wixstatic.com/media/b7b229_c71e8ff2b50d48709149a2a0d527f2bc~mv2.jpg/v1/fill/w_566,h_319,al_c,q_90/b7b229_c71e8ff2b50d48709149a2a0d527f2bc~mv2.webp"
								width="" height="" style="display: none;" alt="">

							<div class="text-center position-relative pt-3" style="height: 100%;width: 100%;">
								<h1 class="text-white">மஹாபெரியவா</h1>
								<h5 class="text-warning">விண்ணையும் மண்ணையும் இணைக்கும் பிரபஞ்ச தெய்வம்!</h5>
							</div>
						</div>
					</figure>
				<!-- </article> -->
			</div>
			<div class="col-md-6 pe-0" style="height: 500px;">
				<!-- <article class="col-sm-12"> -->
					<figure class="text-white">
						<div
							style="height: 500px; background-image: linear-gradient(0deg, rgba(60, 65, 60, 0.4), rgba(77, 75, 75, 0.4)), url('https://static.wixstatic.com/media/b7b229_934ab98b6634445eb93ed631c322ed64~mv2.jpg/v1/fill/w_899,h_505,al_c,q_85,usm_0.66_1.00_0.01/Mama.webp'); background-size: cover; background-position: 50% center;">
							<img src="https://static.wixstatic.com/media/b7b229_934ab98b6634445eb93ed631c322ed64~mv2.jpg/v1/fill/w_899,h_505,al_c,q_85,usm_0.66_1.00_0.01/Mama.webp"
								width="" height="" style="display: none;" alt="">

							<div
								style=" position: relative;top: 0;height: 100%;width: 100%;left: 0;right: 0;bottom: 0;text-align: left;">

							</div>
						</div>
					</figure>
				<!-- </article> -->
			</div>
		</div>
	</div>

	<div class="container-fluid my-5" style="height: calc(100vh)">

		<div class="row m-auto border">

			<div class="col-sm-12 col-md-12 bg-secondary text-white text-center py-3">
				<h2>Call with GR Mama</h2>
				<h6>Use this form to book appointment with GR Mama</h6>
			</div>
		</div>
		<form id="slotSubmit" style="width: 100%;" class="row m-auto border">

			<div class="col-sm-12 col-md-4 bg-white">

				<div class="m-3 slotdisplay" id="slotpickerDisplay">
					<h4 class="my-4">Choose Your appointment Slot</h4>
					<div id="slotpicker"></div>
				</div>

				<div id="slotTime" class="slotdisplay d-none">
					<h4 class="my-4">Choose Your appointment Slot Time</h4>
					<div class="m-3 slotTimeDisplay">
					</div>
				</div>
			</div>

			<div class="col-sm-12 col-md-4 bg-white">

				<div id="personalInformation" class="slotdisplay">
					<h4 class="my-4 pt-3">Personal Information</h4>

					<div class="m-3">
						<label for="firstName" class="form-label">Full Name</label>
						<input type="text" class="form-control" id="firstName" aria-describedby="firstName">
					</div>

					<div class="m-3">
						<label for="emailAddress" class="form-label">Email Address</label>
						<input type="email" class="form-control" id="emailAddress" aria-describedby="emailAddress">
					</div>

					<div class="m-3">
						<label for="phoneNumber" class="form-label">Phone Number</label>
						<input type="tel" class="form-control" id="phoneNumber" aria-describedby="emailHelp">
					</div>

					<div class="m-3">
						<label for="address" class="form-label">Address </label>
						<textarea cols="5" rows="5" class="form-control" id="address"></textarea>
					</div>

					<div class="m-3 d-grid">
						<button type="submit" class="btn btn-info text-white btn-lg">Submit</button>
					</div>
				</div>

			</div>


			<div class="col-sm-12 col-md-4 bg-white border-start">
				<div class="d-flex flex-column mb-2">
					<strong class="text-danger">Important Note</strong>
					<small>Please note that calls with GR Mama will be audio calls only.</small>
				</div>
				<div class="d-flex">

					<img src="https://lh4.googleusercontent.com/tjC79fQNjRuGA0Yd72OOESlx3pG6r6_DjaHTpN9BpFwcRrZkDLUk_aLG5Gh_BLYSuznkKGqkTX3dNLVKE7OG1RXjagx3OMDSlJ2kNN1n0G81FWokCTZaKs6TwEOF_zdt8Q=w740"
						class="img-fluid" />
				</div>
			</div>

		</form>

		<div class="row m-auto bg-white text-dark border">

			<div class="col-sm-12 col-md-12">
				<div class="d-flex align-items-center justify-content-center">
					<div class="d-flex flex-column">
						<strong>MAHAPERIYAVA SHARANAM</strong>
						<img src="https://lh6.googleusercontent.com/qHbNHIwZDnm0I6TWD5pi62IuN-bZp1MpSgDIscl9E6cD3T_n7VmLKoOG_ucc3cGeS7qjSTzqC8AfleAcQW9ttPCKJBLD_-3Pc5gNXnpoNZab4l2WWbpC-jalm4pLvhDMUQ=w144"
							class="img-fluid" />
					</div>
					<div class="p-2">
						<strong class="text-danger p-2">Additional Information</strong>
						<div class="p-2">
							To order books authored by G R Mama please click on <a href="https://bit.ly/booksbyGR"
								class="text-danger"> Book Order </a>
						</div>

						<div class="p-2">
							If you would like to perform Guru Pooja please click on <a
								href="https://bit.ly/GuruPoojaRequest" class="text-danger"> Request for Guru Pooja </a>
						</div>
						<div class="p-2">Visit our website <a href="https://www.periyavaarul.com/"
								class="text-danger">www.periyavaarul.com</a> and visit our
							YouTube
							channel</div>
					</div>

				</div>
			</div>

		</div>
	</div>

	<div class="modal" tabindex="-1">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Modal title</h5>
					<button type="button" class="btn-close text-white" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p>Modal body text goes here.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

</body>

</html>